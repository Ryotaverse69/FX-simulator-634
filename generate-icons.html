<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>PWAアイコン リサイズツール</title>
<style>
  body { font-family: -apple-system, sans-serif; max-width: 600px; margin: 2rem auto; padding: 0 1rem; background: #f8fafc; color: #1e293b; }
  h1 { font-size: 1.4rem; }
  .drop-zone { border: 2px dashed #94a3b8; border-radius: 12px; padding: 2rem; text-align: center; margin: 1rem 0; cursor: pointer; transition: .2s; }
  .drop-zone:hover, .drop-zone.dragover { border-color: #2563eb; background: #eff6ff; }
  .preview { margin: 1rem 0; text-align: center; }
  .preview img { max-width: 256px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,.15); }
  button { background: #2563eb; color: #fff; border: none; padding: .7rem 1.5rem; border-radius: 8px; font-size: 1rem; cursor: pointer; margin-top: 1rem; }
  button:disabled { background: #94a3b8; cursor: not-allowed; }
  button:hover:not(:disabled) { background: #1d4ed8; }
  .sizes { display: flex; flex-wrap: wrap; gap: .5rem; margin-top: 1rem; }
  .sizes span { background: #e2e8f0; padding: .2rem .6rem; border-radius: 6px; font-size: .85rem; }
  .status { margin-top: 1rem; color: #16a34a; font-weight: 600; }
  canvas { display: none; }
</style>
</head>
<body>
<h1>PWAアイコン リサイズツール</h1>
<p>元画像をアップロードすると、PWAに必要な全サイズのPNGアイコンを自動生成してダウンロードします。</p>

<div class="drop-zone" id="dropZone">
  画像をドラッグ＆ドロップ<br>またはクリックして選択
  <input type="file" id="fileInput" accept="image/*" style="display:none;">
</div>

<div class="preview" id="previewArea" style="display:none;">
  <img id="previewImg">
</div>

<div class="sizes">
  生成サイズ:
  <span>72</span><span>96</span><span>128</span><span>144</span><span>152</span><span>192</span><span>384</span><span>512</span>
</div>

<button id="generateBtn" disabled>全サイズ生成＆ダウンロード</button>
<div class="status" id="status"></div>

<canvas id="canvas"></canvas>

<script>
const SIZES = [72, 96, 128, 144, 152, 192, 384, 512];
let loadedImage = null;

const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const previewArea = document.getElementById('previewArea');
const previewImg = document.getElementById('previewImg');
const generateBtn = document.getElementById('generateBtn');
const status = document.getElementById('status');

dropZone.addEventListener('click', () => fileInput.click());
dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', (e) => {
  e.preventDefault();
  dropZone.classList.remove('dragover');
  if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
});
fileInput.addEventListener('change', (e) => { if (e.target.files.length) handleFile(e.target.files[0]); });

function handleFile(file) {
  if (!file.type.startsWith('image/')) { alert('画像ファイルを選択してください'); return; }
  const reader = new FileReader();
  reader.onload = (e) => {
    const img = new Image();
    img.onload = () => {
      loadedImage = img;
      previewImg.src = e.target.result;
      previewArea.style.display = 'block';
      generateBtn.disabled = false;
      status.textContent = `読み込み完了: ${img.width} x ${img.height}px`;
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

generateBtn.addEventListener('click', () => {
  if (!loadedImage) return;
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  let count = 0;
  SIZES.forEach((size, i) => {
    setTimeout(() => {
      canvas.width = size;
      canvas.height = size;
      ctx.clearRect(0, 0, size, size);
      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = 'high';
      ctx.drawImage(loadedImage, 0, 0, size, size);

      const link = document.createElement('a');
      link.download = `icon-${size}.png`;
      link.href = canvas.toDataURL('image/png');
      link.click();

      count++;
      status.textContent = `${count} / ${SIZES.length} サイズ ダウンロード完了`;
    }, i * 300);
  });
});
</script>
</body>
</html>
