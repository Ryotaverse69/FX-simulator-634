<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>多通貨スワップポートフォリオ最適化シミュレーター</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>多通貨スワップポートフォリオ最適化</h1>
      <p class="subtitle" id="brokerSubtitle">GMOクリック証券対応 - リスク・リターン最適化シミュレーター</p>
    </header>

    <main>
      <!-- 証券会社選択 -->
      <section class="card broker-section">
        <h2>証券会社選択</h2>
        <div class="broker-buttons">
          <button class="broker-btn active" data-broker="gmo">
            <span class="broker-name">GMOクリック証券</span>
            <span class="broker-feature">FXネオ</span>
          </button>
          <button class="broker-btn" data-broker="minnano">
            <span class="broker-name">みんなのFX</span>
            <span class="broker-feature">トレイダーズ証券</span>
          </button>
          <button class="broker-btn" data-broker="lightfx">
            <span class="broker-name">LIGHT FX</span>
            <span class="broker-feature">トレイダーズ証券</span>
          </button>
        </div>
      </section>

      <!-- 投資条件入力 -->
      <section class="card">
        <h2>投資条件</h2>
        <div class="input-group">
          <label for="totalCapital">投資資金（円）</label>
          <input type="number" id="totalCapital" value="1000000" min="0" step="10000">
        </div>
        <div class="input-group">
          <label for="targetLeverage">目標レバレッジ</label>
          <input type="number" id="targetLeverage" value="3" min="1" max="25" step="0.1">
        </div>
      </section>

      <!-- 通貨ペア設定 -->
      <section class="card">
        <h2>通貨ペア設定</h2>
        <div class="swap-info-bar">
          <span class="swap-update-date">参考値（最新のスワップは公式サイトで確認）</span>
          <a id="brokerLink" href="https://www.click-sec.com/corp/guide/fxneo/swplog/" target="_blank" class="swap-link">
            📊 公式スワップポイント確認
          </a>
        </div>
        <div class="table-responsive">
          <table id="currencyTable">
            <thead>
              <tr>
                <th>有効</th>
                <th>通貨ペア</th>
                <th>ポジション</th>
                <th>現在レート</th>
                <th>スワップ/日</th>
                <th>年率換算(%)</th>
                <th>ボラティリティ(%)</th>
                <th>取引単位</th>
              </tr>
            </thead>
            <tbody id="currencyBody">
              <!-- JavaScriptで動的に生成 -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- 相関係数マトリクス -->
      <section class="card">
        <h2>相関係数マトリクス</h2>
        <p class="hint">通貨ペア間の相関係数（-1〜1）を設定します。対角線は自動で1になります。</p>
        <div class="table-responsive">
          <table id="correlationMatrix">
            <!-- JavaScriptで動的に生成 -->
          </table>
        </div>
        <button id="resetCorrelation" class="btn-secondary">デフォルト値にリセット</button>
      </section>

      <!-- 最適化設定 -->
      <section class="card">
        <h2>最適化設定</h2>
        <div class="input-group">
          <label for="optimizationTarget">最適化目標</label>
          <select id="optimizationTarget">
            <option value="sharpe">シャープレシオ最大化</option>
            <option value="minRisk">リスク最小化（目標リターン維持）</option>
            <option value="maxReturn">リターン最大化（目標リスク内）</option>
          </select>
        </div>
        <div class="input-group" id="targetReturnGroup" style="display: none;">
          <label for="targetReturn">目標リターン（年率%）</label>
          <input type="number" id="targetReturn" value="20" min="0" max="100" step="1">
        </div>
        <div class="input-group" id="targetRiskGroup" style="display: none;">
          <label for="targetRisk">目標リスク（年率%）</label>
          <input type="number" id="targetRisk" value="15" min="0" max="100" step="1">
        </div>
        <div class="button-group">
          <button id="optimizeBtn" class="btn-primary">最適化を実行</button>
          <button id="calculateBtn" class="btn-secondary">現在の設定で計算</button>
        </div>
      </section>

      <!-- 最適化結果 -->
      <section class="card" id="resultSection" style="display: none;">
        <h2>最適化結果</h2>

        <div class="result-summary">
          <div class="result-item">
            <span class="label">期待リターン（年率）</span>
            <span class="value" id="expectedReturn">-</span>
          </div>
          <div class="result-item">
            <span class="label">ポートフォリオリスク（年率）</span>
            <span class="value" id="portfolioRisk">-</span>
          </div>
          <div class="result-item has-tooltip">
            <span class="label">シャープレシオ <span class="info-icon" title="詳細を見る">?</span></span>
            <span class="value" id="sharpeRatio">-</span>
          </div>
          <div class="result-item">
            <span class="label">年間スワップ収益（税前）</span>
            <span class="value" id="annualSwap">-</span>
          </div>
        </div>

        <!-- シャープレシオ説明 -->
        <div class="sharpe-explanation">
          <h4>📊 シャープレシオとは？</h4>
          <p>
            <strong>シャープレシオ</strong>は、リスク1単位あたりのリターンを示す指標です。
            値が高いほど「効率的な投資」と言えます。
          </p>
          <div class="sharpe-formula">
            <code>シャープレシオ = (期待リターン − 無リスク金利) ÷ リスク（標準偏差）</code>
          </div>
          <div class="sharpe-guide">
            <div class="guide-item poor">
              <span class="guide-value">&lt; 0.5</span>
              <span class="guide-label">低い</span>
            </div>
            <div class="guide-item fair">
              <span class="guide-value">0.5〜1.0</span>
              <span class="guide-label">普通</span>
            </div>
            <div class="guide-item good">
              <span class="guide-value">1.0〜2.0</span>
              <span class="guide-label">良い</span>
            </div>
            <div class="guide-item excellent">
              <span class="guide-value">&gt; 2.0</span>
              <span class="guide-label">優秀</span>
            </div>
          </div>
          <p class="sharpe-note">
            ※ 一般的に1.0以上であれば良好、2.0以上は非常に優秀とされています。
            ただし、高すぎる値は計算条件の見直しが必要な場合もあります。
          </p>
        </div>

        <!-- 最適ポジション -->
        <h3>最適ポジション配分</h3>
        <div class="table-responsive">
          <table id="resultTable">
            <thead>
              <tr>
                <th>通貨ペア</th>
                <th>ポジション</th>
                <th>配分比率</th>
                <th>保有数量</th>
                <th>必要証拠金</th>
                <th>年間スワップ</th>
              </tr>
            </thead>
            <tbody id="resultBody">
            </tbody>
          </table>
        </div>

        <!-- グラフ -->
        <div class="charts-container">
          <div class="chart-wrapper">
            <h3>ポートフォリオ構成</h3>
            <canvas id="allocationChart"></canvas>
          </div>
          <div class="chart-wrapper">
            <h3>効率的フロンティア</h3>
            <canvas id="frontierChart"></canvas>
          </div>
        </div>

        <!-- リスク分解 -->
        <h3>リスク寄与度</h3>
        <div class="table-responsive">
          <table id="riskContributionTable">
            <thead>
              <tr>
                <th>通貨ペア</th>
                <th>リスク寄与度</th>
                <th>寄与率(%)</th>
              </tr>
            </thead>
            <tbody id="riskContributionBody">
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <footer>
      <p>※このシミュレーターは投資の参考情報を提供するものであり、投資助言ではありません。実際の投資は自己責任で行ってください。</p>
    </footer>
  </div>

  <script src="script.js"></script>
</body>
</html>
